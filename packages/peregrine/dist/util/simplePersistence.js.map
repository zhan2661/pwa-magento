{"version":3,"sources":["../../src/util/simplePersistence.js"],"names":["NamespacedLocalStorage","localStorage","key","name","getItem","_makeKey","value","setItem","removeItem","BrowserPersistence","storage","window","constructor","KEY","now","Date","item","undefined","JSON","parse","ttl","timeStored","stringify"],"mappings":";;;;AAAA;;;IAIMA,sB;;;AACF,kCAAYC,YAAZ,EAA0BC,GAA1B,EAA+B;AAAA;;AAC3B,SAAKD,YAAL,GAAoBA,YAApB;AACA,SAAKC,GAAL,GAAWA,GAAX;AACH;;;;6BACQA,G,EAAK;AACV,uBAAU,KAAKA,GAAf,eAAuBA,GAAvB;AACH;;;4BACOC,I,EAAM;AACV,aAAO,KAAKF,YAAL,CAAkBG,OAAlB,CAA0B,KAAKC,QAAL,CAAcF,IAAd,CAA1B,CAAP;AACH;;;4BACOA,I,EAAMG,K,EAAO;AACjB,aAAO,KAAKL,YAAL,CAAkBM,OAAlB,CAA0B,KAAKF,QAAL,CAAcF,IAAd,CAA1B,EAA+CG,KAA/C,CAAP;AACH;;;+BACUH,I,EAAM;AACb,aAAO,KAAKF,YAAL,CAAkBO,UAAlB,CAA6B,KAAKH,QAAL,CAAcF,IAAd,CAA7B,CAAP;AACH;;;;;;IAGgBM,kB;;;AAEjB,gCAAc;AAAA;;AACV,SAAKC,OAAL,GAAe,IAAIV,sBAAJ,CACXW,MAAM,CAACV,YADI,EAEX,KAAKW,WAAL,CAAiBC,GAAjB,IAAwBJ,kBAAkB,CAACI,GAFhC,CAAf;AAIH;;;;4BACOV,I,EAAM;AACV,UAAMW,GAAG,GAAGC,IAAI,CAACD,GAAL,EAAZ;AACA,UAAME,IAAI,GAAG,KAAKN,OAAL,CAAaN,OAAb,CAAqBD,IAArB,CAAb;;AACA,UAAI,CAACa,IAAL,EAAW;AACP,eAAOC,SAAP;AACH;;AALS,wBAMyBC,IAAI,CAACC,KAAL,CAAWH,IAAX,CANzB;AAAA,UAMFV,KANE,eAMFA,KANE;AAAA,UAMKc,GANL,eAMKA,GANL;AAAA,UAMUC,UANV,eAMUA,UANV;;AAOV,UAAID,GAAG,IAAIN,GAAG,GAAGO,UAAN,GAAmBD,GAAG,GAAG,IAApC,EAA0C;AACtC,aAAKV,OAAL,CAAaF,UAAb,CAAwBL,IAAxB;AACA,eAAOc,SAAP;AACH;;AACD,aAAOC,IAAI,CAACC,KAAL,CAAWb,KAAX,CAAP;AACH;;;4BACOH,I,EAAMG,K,EAAOc,G,EAAK;AACtB,UAAMC,UAAU,GAAGN,IAAI,CAACD,GAAL,EAAnB;AACA,WAAKJ,OAAL,CAAaH,OAAb,CACIJ,IADJ,EAEIe,IAAI,CAACI,SAAL,CAAe;AACXhB,QAAAA,KAAK,EAAEY,IAAI,CAACI,SAAL,CAAehB,KAAf,CADI;AAEXe,QAAAA,UAAU,EAAVA,UAFW;AAGXD,QAAAA,GAAG,EAAHA;AAHW,OAAf,CAFJ;AAQH;;;+BACUjB,I,EAAM;AACb,WAAKO,OAAL,CAAaF,UAAb,CAAwBL,IAAxB;AACH;;;;;;gBAlCgBM,kB,SACJ,8B;;SADIA,kB","sourcesContent":["/**\n * Persistence layer with expiration based on localStorage.\n */\n\nclass NamespacedLocalStorage {\n    constructor(localStorage, key) {\n        this.localStorage = localStorage;\n        this.key = key;\n    }\n    _makeKey(key) {\n        return `${this.key}__${key}`;\n    }\n    getItem(name) {\n        return this.localStorage.getItem(this._makeKey(name));\n    }\n    setItem(name, value) {\n        return this.localStorage.setItem(this._makeKey(name), value);\n    }\n    removeItem(name) {\n        return this.localStorage.removeItem(this._makeKey(name));\n    }\n}\n\nexport default class BrowserPersistence {\n    static KEY = 'M2_VENIA_BROWSER_PERSISTENCE';\n    constructor() {\n        this.storage = new NamespacedLocalStorage(\n            window.localStorage,\n            this.constructor.KEY || BrowserPersistence.KEY\n        );\n    }\n    getItem(name) {\n        const now = Date.now();\n        const item = this.storage.getItem(name);\n        if (!item) {\n            return undefined;\n        }\n        const { value, ttl, timeStored } = JSON.parse(item);\n        if (ttl && now - timeStored > ttl * 1000) {\n            this.storage.removeItem(name);\n            return undefined;\n        }\n        return JSON.parse(value);\n    }\n    setItem(name, value, ttl) {\n        const timeStored = Date.now();\n        this.storage.setItem(\n            name,\n            JSON.stringify({\n                value: JSON.stringify(value),\n                timeStored,\n                ttl\n            })\n        );\n    }\n    removeItem(name) {\n        this.storage.removeItem(name);\n    }\n}\n"],"file":"simplePersistence.js"}