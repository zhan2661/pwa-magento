{"version":3,"sources":["../../../src/Router/__tests__/MagentoRouteHandler.test.js"],"names":["React","MagentoRouteHandler","shallow","resolveUnknownRoute","fetchRootComponent","global","jest","fn","mock","apiBase","children","location","pathname","props","resolvedRoute","type","id","beforeEach","mockClear","afterEach","mockRestore","test","expect","toHaveBeenCalledTimes","toHaveBeenNthCalledWith","hasError","internalError","loading","notFound","localProps","not","toHaveBeenCalled","mockRejectedValue","Error","Promise","resolve","mockResolvedValue","matched","wrapper","state","size","toBe","RootComponent","find","toHaveLength","setProps"],"mappings":"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","sourcesContent":["import React from 'react';\nimport MagentoRouteHandler from '../MagentoRouteHandler';\nimport { shallow } from 'enzyme';\nimport resolveUnknownRoute from '../resolveUnknownRoute';\n\nconst fetchRootComponent = (global.fetchRootComponent = jest.fn());\n\njest.mock('../resolveUnknownRoute');\n\nconst apiBase = 'https://store.com';\nconst children = jest.fn();\nconst location = { pathname: '/foo.html' };\n\nconst props = { apiBase, children, location };\n\nconst resolvedRoute = {\n    type: 'CMS_PAGE',\n    id: 2\n};\n\nbeforeEach(() => {\n    children.mockClear();\n});\n\nafterEach(() => {\n    resolveUnknownRoute.mockRestore();\n    fetchRootComponent.mockRestore();\n});\n\ntest('renders `loading` while loading', () => {\n    shallow(<MagentoRouteHandler {...props} />);\n\n    expect(children).toHaveBeenCalledTimes(1);\n    expect(children).toHaveBeenNthCalledWith(1, {\n        hasError: false,\n        internalError: false,\n        loading: true,\n        notFound: false\n    });\n});\n\ntest('renders `null` while loading if `children` is not a function', () => {\n    const localProps = { ...props };\n\n    delete localProps.children;\n    shallow(<MagentoRouteHandler {...localProps} />);\n\n    expect(children).not.toHaveBeenCalled();\n});\n\ntest('renders `internalError` if `resolveUnknownRoute` fails', async () => {\n    resolveUnknownRoute.mockRejectedValue(new Error());\n    shallow(<MagentoRouteHandler {...props} />);\n\n    await Promise.resolve(); // resolveUnknownRoute\n\n    expect(children).toHaveBeenCalledTimes(2);\n    expect(children).toHaveBeenNthCalledWith(1, {\n        hasError: false,\n        internalError: false,\n        loading: true,\n        notFound: false\n    });\n    expect(children).toHaveBeenNthCalledWith(2, {\n        hasError: true,\n        internalError: true,\n        loading: false,\n        notFound: false\n    });\n});\n\ntest('renders `notFound` if resolved route is not matched', async () => {\n    resolveUnknownRoute.mockResolvedValue({ matched: false });\n    shallow(<MagentoRouteHandler {...props} />);\n\n    await Promise.resolve(); // resolveUnknownRoute\n\n    expect(children).toHaveBeenCalledTimes(2);\n    expect(children).toHaveBeenNthCalledWith(1, {\n        hasError: false,\n        internalError: false,\n        loading: true,\n        notFound: false\n    });\n    expect(children).toHaveBeenNthCalledWith(2, {\n        hasError: true,\n        internalError: false,\n        loading: false,\n        notFound: true\n    });\n});\n\ntest('renders `internalError` if `fetchRootComponent` fails', async () => {\n    resolveUnknownRoute.mockResolvedValue(resolvedRoute);\n    fetchRootComponent.mockRejectedValue(new Error());\n\n    const wrapper = shallow(<MagentoRouteHandler {...props} />);\n\n    await Promise.resolve(); // resolveUnknownRoute\n    await Promise.resolve(); // fetchRootComponent\n\n    expect(wrapper.state('componentMap').size).toBe(1);\n    expect(children).toHaveBeenCalledTimes(2);\n    expect(children).toHaveBeenNthCalledWith(1, {\n        hasError: false,\n        internalError: false,\n        loading: true,\n        notFound: false\n    });\n    expect(children).toHaveBeenNthCalledWith(2, {\n        hasError: true,\n        internalError: true,\n        loading: false,\n        notFound: false\n    });\n});\n\ntest('renders RootComponent if `fetchRootComponent` succeeds', async () => {\n    const RootComponent = () => <i />;\n\n    resolveUnknownRoute.mockResolvedValue(resolvedRoute);\n    fetchRootComponent.mockResolvedValue(RootComponent);\n\n    const wrapper = shallow(<MagentoRouteHandler {...props} />);\n\n    await Promise.resolve(); // resolveUnknownRoute\n    await Promise.resolve(); // fetchRootComponent\n\n    expect(children).toHaveBeenCalledTimes(1);\n    expect(children).toHaveBeenNthCalledWith(1, {\n        hasError: false,\n        internalError: false,\n        loading: true,\n        notFound: false\n    });\n    expect(wrapper.find(RootComponent)).toHaveLength(1);\n});\n\ntest('skips `fetchRootComponent` if path is known', async () => {\n    const RootComponent = () => <i />;\n\n    resolveUnknownRoute.mockResolvedValue(resolvedRoute);\n    fetchRootComponent.mockResolvedValue(RootComponent);\n\n    const wrapper = shallow(<MagentoRouteHandler {...props} />);\n\n    await Promise.resolve(); // resolveUnknownRoute\n    await Promise.resolve(); // fetchRootComponent\n\n    // navigate to `bar`\n    wrapper.setProps({ ...props, location: { pathname: '/bar.html' } });\n\n    await Promise.resolve(); // resolveUnknownRoute\n    await Promise.resolve(); // fetchRootComponent\n\n    // navigate back to `foo`\n    wrapper.setProps(props);\n\n    await Promise.resolve(); // resolveUnknownRoute\n    await Promise.resolve(); // fetchRootComponent\n\n    expect(children).toHaveBeenCalledTimes(2);\n    expect(fetchRootComponent).toHaveBeenCalledTimes(2);\n    expect(wrapper.find(RootComponent)).toHaveLength(1);\n});\n"],"file":"MagentoRouteHandler.test.js"}