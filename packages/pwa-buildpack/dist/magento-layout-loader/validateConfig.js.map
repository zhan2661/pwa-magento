{"version":3,"sources":["../../src/magento-layout-loader/validateConfig.js"],"names":["Ajv","require","ajv","module","exports","config","rules","Object","values","rule","validator","validatorsByOperation","operation","errors","length","passed","error","formatError","message","JSON","stringify","removeContainer","compile","additionalProperties","required","properties","constant","targetContainer","type","removeChild","targetChild","insertBefore","componentPath","insertAfter"],"mappings":"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","sourcesContent":["const Ajv = require('ajv');\n\nconst ajv = new Ajv();\n\n/**\n * Given an aggregate configuration for all layout operations\n * (generated by the Magento store), validates each config conforms\n * to babel-plugin-magento-layout's requirements\n *\n * @param {object} config\n * @returns {{ passed: bool, error: string | null }}\n */\nmodule.exports = config => {\n    for (const rules of Object.values(config)) {\n        for (const rule of rules) {\n            const validator = validatorsByOperation[rule.operation];\n            validator(rule);\n            if (validator.errors && validator.errors.length) {\n                return {\n                    passed: false,\n                    error: formatError(validator.errors[0], rule)\n                };\n            }\n        }\n    }\n\n    return { passed: true, error: null };\n};\n\nfunction formatError(error, rule) {\n    const { message } = error;\n    return (\n        `Encountered a layout configuration that does not match the required schema.\\n` +\n        `Message: ${message}\\n` +\n        `Received: ${JSON.stringify(rule)}`\n    );\n}\n\nconst validatorsByOperation = {\n    removeContainer: ajv.compile({\n        additionalProperties: false,\n        required: ['operation', 'targetContainer'],\n        properties: {\n            operation: { constant: 'removeContainer' },\n            targetContainer: { type: 'string' }\n        }\n    }),\n\n    removeChild: ajv.compile({\n        additionalProperties: false,\n        required: ['operation', 'targetContainer', 'targetChild'],\n        properties: {\n            operation: { constant: 'removeChild' },\n            targetContainer: { type: 'string' },\n            targetChild: { type: 'string' }\n        }\n    }),\n\n    insertBefore: ajv.compile({\n        additionalProperties: false,\n        required: [\n            'operation',\n            'targetContainer',\n            'targetChild',\n            'componentPath'\n        ],\n        properties: {\n            operation: { constant: 'insertBefore' },\n            targetContainer: { type: 'string' },\n            targetChild: { type: 'string' },\n            componentPath: { type: 'string' }\n        }\n    }),\n\n    insertAfter: ajv.compile({\n        additionalProperties: false,\n        required: [\n            'operation',\n            'targetContainer',\n            'targetChild',\n            'componentPath'\n        ],\n        properties: {\n            operation: { constant: 'insertAfter' },\n            targetContainer: { type: 'string' },\n            targetChild: { type: 'string' },\n            componentPath: { type: 'string' }\n        }\n    })\n};\n"],"file":"validateConfig.js"}